---
title: "I18n API"
description: "Internationalization manager interface for multi-language support"
category: "api"
tags: ["api", "i18n", "internationalization", "localization", "translation"]
version: "1.0.0"
last_updated: "2025-11-28"
related:
  - "framework.md"
  - "context.md"
  - "../guides/i18n.md"
---

# I18n API

## Overview

The `I18nManager` interface provides comprehensive internationalization (i18n) support for the Rockstar Web Framework. It enables multi-language applications with features including translation management, pluralization, parameter substitution, and fallback handling.

The i18n manager loads translations from YAML files and provides a simple API for translating strings in your application.

**Primary Use Cases:**
- Multi-language web applications
- Localized error messages
- User interface translations
- Email template localization
- Dynamic content translation

## Interface Definition

```go
type I18nManager interface {
    // Translation
    Translate(key string, params ...interface{}) string
    TranslateWithLang(locale, key string, params ...interface{}) string
    TranslatePlural(key string, count int, params ...interface{}) string
    TranslatePluralWithLang(locale, key string, count int, params ...interface{}) string

    // Error translation
    TranslateError(err *FrameworkError) string
    TranslateErrorWithLang(lang string, err *FrameworkError) string

    // Language management
    SetLanguage(locale string) error
    GetLanguage() string
    GetSupportedLanguages() []string
    IsLanguageSupported(lang string) bool
    GetDefaultLanguage() string

    // Locale loading
    LoadLocale(locale string, data map[string]interface{}) error
    LoadLocaleFromFile(locale, filepath string) error
    ReloadLocales() error

    // Context-aware translation
    TranslateForContext(ctx Context, key string, params ...interface{}) string
}
```

## Configuration

### I18nConfig

```go
type I18nConfig struct {
    // DefaultLocale is the fallback locale when translation is not found
    // Default: "en"
    DefaultLocale string

    // LocalesDir is the directory containing locale files
    // Default: ""
    LocalesDir string

    // SupportedLocales is the list of supported locales
    // Default: []
    SupportedLocales []string

    // FallbackToDefault determines if missing translations should fall back to default locale
    // Default: true
    FallbackToDefault bool
}
```

**Example**:
```go
config := pkg.I18nConfig{
    DefaultLocale:     "en",
    LocalesDir:        "./locales",
    SupportedLocales:  []string{"en", "de", "fr", "es"},
    FallbackToDefault: true,
}
```

### Locale File Format

Locale files use YAML format with nested structure:

**locales.en.yaml**:
```yaml
welcome:
  message: "Welcome to our application!"
  title: "Welcome"

error:
  auth:
    failed: "Authentication failed"
    invalid_credentials: "Invalid username or password"
  validation:
    required: "{{field}} is required"
    email: "{{field}} must be a valid email"

items:
  count:
    one: "You have {{count}} item"
    other: "You have {{count}} items"

user:
  greeting: "Hello, {{name}}!"
  profile:
    updated: "Profile updated successfully"
```

**locales.de.yaml**:
```yaml
welcome:
  message: "Willkommen in unserer Anwendung!"
  title: "Willkommen"

error:
  auth:
    failed: "Authentifizierung fehlgeschlagen"
    invalid_credentials: "Ungültiger Benutzername oder Passwort"
  validation:
    required: "{{field}} ist erforderlich"
    email: "{{field}} muss eine gültige E-Mail sein"

items:
  count:
    one: "Sie haben {{count}} Artikel"
    other: "Sie haben {{count}} Artikel"

user:
  greeting: "Hallo, {{name}}!"
  profile:
    updated: "Profil erfolgreich aktualisiert"
```

## Translation Methods

### Translate

```go
func Translate(key string, params ...interface{}) string
```

**Description**: Translates a key using the current locale. Supports parameter substitution with `{{param}}` syntax.

**Parameters**:
- `key` (string): Translation key (dot-notation for nested keys)
- `params` (...interface{}): Optional parameters as map[string]interface{}

**Returns**:
- `string`: Translated string, or the key itself if translation not found

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Simple translation
    welcome := i18n.Translate("welcome.message")
    
    // Translation with parameters
    greeting := i18n.Translate("user.greeting", map[string]interface{}{
        "name": "John",
    })
    
    // Nested key translation
    error := i18n.Translate("error.auth.failed")
    
    return ctx.JSON(200, map[string]string{
        "welcome":  welcome,
        "greeting": greeting,
        "error":    error,
    })
}
```

### TranslateWithLang

```go
func TranslateWithLang(locale, key string, params ...interface{}) string
```

**Description**: Translates a key using a specific locale, overriding the current locale.

**Parameters**:
- `locale` (string): Target locale (e.g., "en", "de", "fr")
- `key` (string): Translation key
- `params` (...interface{}): Optional parameters

**Returns**:
- `string`: Translated string in the specified locale

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Get language from request header or query
    lang := ctx.GetHeader("Accept-Language")
    if lang == "" {
        lang = ctx.Query()["lang"]
    }
    if lang == "" {
        lang = "en"
    }
    
    // Translate in specific language
    message := i18n.TranslateWithLang(lang, "welcome.message")
    
    return ctx.JSON(200, map[string]string{
        "message": message,
        "lang":    lang,
    })
}
```

### TranslatePlural

```go
func TranslatePlural(key string, count int, params ...interface{}) string
```

**Description**: Translates a key with plural support based on count. Uses plural rules for the current locale.

**Parameters**:
- `key` (string): Base translation key (without .one or .other suffix)
- `count` (int): Count for plural determination
- `params` (...interface{}): Optional parameters (count is automatically added)

**Returns**:
- `string`: Translated string with correct plural form

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    itemCount := 5
    
    // Automatically selects "items.count.one" or "items.count.other"
    message := i18n.TranslatePlural("items.count", itemCount)
    // Result: "You have 5 items"
    
    // With explicit parameters
    message = i18n.TranslatePlural("items.count", itemCount, map[string]interface{}{
        "count": itemCount,
    })
    
    return ctx.JSON(200, map[string]string{
        "message": message,
    })
}
```

### TranslatePluralWithLang

```go
func TranslatePluralWithLang(locale, key string, count int, params ...interface{}) string
```

**Description**: Translates a key with plural support in a specific locale.

**Parameters**:
- `locale` (string): Target locale
- `key` (string): Base translation key
- `count` (int): Count for plural determination
- `params` (...interface{}): Optional parameters

**Returns**:
- `string`: Translated string with correct plural form in specified locale

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    itemCount := 1
    
    // English: "You have 1 item"
    enMessage := i18n.TranslatePluralWithLang("en", "items.count", itemCount)
    
    // German: "Sie haben 1 Artikel"
    deMessage := i18n.TranslatePluralWithLang("de", "items.count", itemCount)
    
    return ctx.JSON(200, map[string]interface{}{
        "en": enMessage,
        "de": deMessage,
    })
}
```

## Error Translation

### TranslateError

```go
func TranslateError(err *FrameworkError) string
```

**Description**: Translates a framework error using its i18n key and parameters.

**Parameters**:
- `err` (*FrameworkError): Framework error with i18n metadata

**Returns**:
- `string`: Translated error message

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Create framework error with i18n key
    err := &pkg.FrameworkError{
        Code:       "VALIDATION_ERROR",
        Message:    "Validation failed",
        I18nKey:    "error.validation.required",
        I18nParams: map[string]interface{}{"field": "email"},
    }
    
    // Translate error
    translatedError := i18n.TranslateError(err)
    // Result: "email is required"
    
    return ctx.JSON(400, map[string]string{
        "error": translatedError,
    })
}
```

### TranslateErrorWithLang

```go
func TranslateErrorWithLang(lang string, err *FrameworkError) string
```

**Description**: Translates a framework error in a specific language.

**Parameters**:
- `lang` (string): Target language
- `err` (*FrameworkError): Framework error

**Returns**:
- `string`: Translated error message in specified language

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    lang := ctx.GetHeader("Accept-Language")
    
    err := &pkg.FrameworkError{
        I18nKey:    "error.auth.failed",
        I18nParams: nil,
    }
    
    translatedError := i18n.TranslateErrorWithLang(lang, err)
    
    return ctx.JSON(401, map[string]string{
        "error": translatedError,
    })
}
```

## Language Management

### SetLanguage

```go
func SetLanguage(locale string) error
```

**Description**: Sets the current locale for this i18n manager instance.

**Parameters**:
- `locale` (string): Locale code (e.g., "en", "de")

**Returns**:
- `error`: Error if locale is not supported

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Set language from user preference
    userLang := ctx.Query()["lang"]
    if userLang != "" {
        if err := i18n.SetLanguage(userLang); err != nil {
            return ctx.JSON(400, map[string]string{
                "error": "Unsupported language",
            })
        }
    }
    
    message := i18n.Translate("welcome.message")
    return ctx.JSON(200, map[string]string{"message": message})
}
```

### GetLanguage

```go
func GetLanguage() string
```

**Description**: Returns the current locale.

**Returns**:
- `string`: Current locale code

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    currentLang := i18n.GetLanguage()
    
    return ctx.JSON(200, map[string]string{
        "current_language": currentLang,
    })
}
```

### GetSupportedLanguages

```go
func GetSupportedLanguages() []string
```

**Description**: Returns all available locales that have been loaded.

**Returns**:
- `[]string`: List of supported locale codes

**Example**:
```go
func languagesHandler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    languages := i18n.GetSupportedLanguages()
    
    return ctx.JSON(200, map[string]interface{}{
        "languages": languages,
    })
}
```

### IsLanguageSupported

```go
func IsLanguageSupported(lang string) bool
```

**Description**: Checks if a language is supported (has translations loaded).

**Parameters**:
- `lang` (string): Language code to check

**Returns**:
- `bool`: true if language is supported, false otherwise

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    requestedLang := ctx.Query()["lang"]
    
    if !i18n.IsLanguageSupported(requestedLang) {
        return ctx.JSON(400, map[string]string{
            "error": "Language not supported",
        })
    }
    
    i18n.SetLanguage(requestedLang)
    message := i18n.Translate("welcome.message")
    
    return ctx.JSON(200, map[string]string{"message": message})
}
```

### GetDefaultLanguage

```go
func GetDefaultLanguage() string
```

**Description**: Returns the default/fallback locale.

**Returns**:
- `string`: Default locale code

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    defaultLang := i18n.GetDefaultLanguage()
    
    return ctx.JSON(200, map[string]string{
        "default_language": defaultLang,
    })
}
```

## Locale Loading

### LoadLocale

```go
func LoadLocale(locale string, data map[string]interface{}) error
```

**Description**: Loads translations for a locale from a map. Useful for programmatic translation loading.

**Parameters**:
- `locale` (string): Locale code
- `data` (map[string]interface{}): Translation data (nested maps)

**Returns**:
- `error`: Error if loading fails

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Load custom translations
    translations := map[string]interface{}{
        "custom": map[string]interface{}{
            "message": "Custom message",
            "title":   "Custom Title",
        },
    }
    
    err := i18n.LoadLocale("en", translations)
    if err != nil {
        return ctx.JSON(500, map[string]string{"error": "Failed to load translations"})
    }
    
    return ctx.JSON(200, map[string]string{"message": "Translations loaded"})
}
```

### LoadLocaleFromFile

```go
func LoadLocaleFromFile(locale, filepath string) error
```

**Description**: Loads translations for a locale from a YAML file.

**Parameters**:
- `locale` (string): Locale code
- `filepath` (string): Path to YAML file

**Returns**:
- `error`: Error if file reading or parsing fails

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Load additional locale file
    err := i18n.LoadLocaleFromFile("es", "./locales/locales.es.yaml")
    if err != nil {
        return ctx.JSON(500, map[string]string{"error": "Failed to load locale file"})
    }
    
    return ctx.JSON(200, map[string]string{"message": "Locale loaded"})
}
```

### ReloadLocales

```go
func ReloadLocales() error
```

**Description**: Reloads all locale files from the configured locales directory.

**Returns**:
- `error`: Error if reloading fails

**Example**:
```go
func reloadHandler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    if err := i18n.ReloadLocales(); err != nil {
        return ctx.JSON(500, map[string]string{"error": "Failed to reload locales"})
    }
    
    return ctx.JSON(200, map[string]string{"message": "Locales reloaded"})
}
```

## Context-Aware Translation

### TranslateForContext

```go
func TranslateForContext(ctx Context, key string, params ...interface{}) string
```

**Description**: Translates a key using the context's language preference (from headers, session, etc.).

**Parameters**:
- `ctx` (Context): Request context
- `key` (string): Translation key
- `params` (...interface{}): Optional parameters

**Returns**:
- `string`: Translated string

**Example**:
```go
func handler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Automatically uses language from context
    message := i18n.TranslateForContext(ctx, "welcome.message")
    
    return ctx.JSON(200, map[string]string{"message": message})
}
```

## Complete Example

Here's a complete example demonstrating i18n in a multi-language application:

```go
package main

import (
    "github.com/echterhof/rockstar-web-framework/pkg"
)

func main() {
    config := pkg.FrameworkConfig{
        I18nConfig: pkg.I18nConfig{
            DefaultLocale:     "en",
            LocalesDir:        "./locales",
            SupportedLocales:  []string{"en", "de", "fr"},
            FallbackToDefault: true,
        },
    }

    app, _ := pkg.New(config)
    router := app.Router()

    // Language detection middleware
    app.Use(languageMiddleware)

    // Routes
    router.GET("/", homeHandler)
    router.GET("/languages", languagesHandler)
    router.POST("/language", setLanguageHandler)

    app.Listen(":8080")
}

func languageMiddleware(ctx pkg.Context, next pkg.HandlerFunc) error {
    i18n := ctx.I18n()
    
    // Try to get language from query parameter
    lang := ctx.Query()["lang"]
    
    // Fall back to Accept-Language header
    if lang == "" {
        lang = ctx.GetHeader("Accept-Language")
    }
    
    // Fall back to session
    if lang == "" {
        if session, err := ctx.Session().GetSessionFromCookie(ctx); err == nil {
            if sessionLang, ok := session.Data["language"].(string); ok {
                lang = sessionLang
            }
        }
    }
    
    // Set language if valid
    if lang != "" && i18n.IsLanguageSupported(lang) {
        i18n.SetLanguage(lang)
    }
    
    return next(ctx)
}

func homeHandler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    // Get user name from session or default
    userName := "Guest"
    if session, err := ctx.Session().GetSessionFromCookie(ctx); err == nil {
        if name, ok := session.Data["name"].(string); ok {
            userName = name
        }
    }
    
    // Translate messages
    welcome := i18n.Translate("welcome.message")
    greeting := i18n.Translate("user.greeting", map[string]interface{}{
        "name": userName,
    })
    
    // Plural example
    itemCount := 5
    itemsMessage := i18n.TranslatePlural("items.count", itemCount)
    
    return ctx.JSON(200, map[string]interface{}{
        "welcome":       welcome,
        "greeting":      greeting,
        "items_message": itemsMessage,
        "language":      i18n.GetLanguage(),
    })
}

func languagesHandler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    
    languages := i18n.GetSupportedLanguages()
    current := i18n.GetLanguage()
    defaultLang := i18n.GetDefaultLanguage()
    
    return ctx.JSON(200, map[string]interface{}{
        "supported": languages,
        "current":   current,
        "default":   defaultLang,
    })
}

func setLanguageHandler(ctx pkg.Context) error {
    i18n := ctx.I18n()
    lang := ctx.FormValue("language")
    
    if !i18n.IsLanguageSupported(lang) {
        errorMsg := i18n.Translate("error.validation.invalid_language")
        return ctx.JSON(400, map[string]string{"error": errorMsg})
    }
    
    // Set language
    if err := i18n.SetLanguage(lang); err != nil {
        return ctx.JSON(500, map[string]string{"error": "Failed to set language"})
    }
    
    // Save to session
    if session, err := ctx.Session().GetSessionFromCookie(ctx); err == nil {
        session.Data["language"] = lang
        ctx.Session().Save(ctx, session)
    }
    
    successMsg := i18n.Translate("user.profile.updated")
    return ctx.JSON(200, map[string]string{
        "message":  successMsg,
        "language": lang,
    })
}
```

## Best Practices

### Key Naming

Use hierarchical, descriptive keys:

```yaml
# Good
user:
  greeting: "Hello, {{name}}!"
  profile:
    updated: "Profile updated"
error:
  auth:
    failed: "Authentication failed"

# Bad
msg1: "Hello"
err: "Failed"
```

### Parameter Substitution

Always use descriptive parameter names:

```yaml
# Good
message: "Welcome, {{username}}! You have {{count}} new messages."

# Bad
message: "Welcome, {{p1}}! You have {{p2}} new messages."
```

### Pluralization

Define both singular and plural forms:

```yaml
items:
  count:
    one: "{{count}} item"
    other: "{{count}} items"
```

### Fallback Handling

Always enable fallback to default locale:

```go
config := pkg.I18nConfig{
    FallbackToDefault: true,  // Always set to true
}
```

### Language Detection

Implement a clear language detection priority:

1. Query parameter (`?lang=de`)
2. Session/Cookie
3. Accept-Language header
4. Default locale

## See Also

- [Framework API](framework.md)
- [Context API](context.md)
- [Internationalization Guide](../guides/i18n.md)
