# ============================================================================
# Rockstar Web Framework - Plugin Configuration Example (YAML)
# ============================================================================
#
# This file demonstrates all available plugin configuration options.
# The plugin system allows you to extend framework functionality through
# dynamically loadable modules.
#
# Requirements Addressed:
# - 3.1: Support for YAML configuration format
# - 3.3: Enabled flag filtering for selective plugin loading
# - 3.4: Initialization parameters passed to plugins
# - 3.5: Load order preservation through configuration sequence
#
# ============================================================================

# Global plugin system configuration
plugins:
  # Enable or disable the entire plugin system
  enabled: true
  
  # Base directory for plugin discovery (optional)
  # Relative paths in plugin configurations will be resolved from this directory
  directory: ./plugins
  
  # Maximum number of concurrent plugin operations (optional)
  # Default: 10
  max_concurrent_operations: 10
  
  # Error threshold before auto-disabling a plugin (optional)
  # Default: 100
  error_threshold: 100
  
  # Enable hot reload support (optional)
  # Default: true
  hot_reload_enabled: true
  
  # Plugin load timeout in seconds (optional)
  # Default: 30
  load_timeout: 30
  
  # List of plugins to load
  # Plugins are loaded in the order specified here (load order preservation)
  plugins:
    # ========================================================================
    # Example 1: Minimal Plugin Configuration
    # ========================================================================
    # This demonstrates the minimum required configuration for a plugin
    - name: minimal-plugin
      enabled: true
      path: ./plugins/minimal-plugin
      
    # ========================================================================
    # Example 2: Authentication Plugin with Full Configuration
    # ========================================================================
    # This demonstrates all available configuration options
    - name: auth-plugin
      # Whether this plugin should be loaded (enabled flag filtering)
      enabled: true
      
      # Path to the plugin binary or directory
      # Can be absolute or relative to the plugins.directory setting
      path: ./plugins/auth-plugin
      
      # Priority determines hook execution order (higher = earlier)
      # Range: 0-1000, Default: 100
      priority: 200
      
      # Plugin-specific configuration (initialization parameters)
      # These values are passed to the plugin's Initialize() method
      config:
        # JWT token configuration
        jwt_secret: "your-secret-key-here"
        token_duration: "2h"
        refresh_token_duration: "168h"  # 7 days
        
        # Authentication requirements
        require_auth: true
        allow_anonymous: false
        
        # Paths that don't require authentication
        excluded_paths:
          - "/health"
          - "/metrics"
          - "/public"
          - "/api/docs"
          - "/api/v1/auth/login"
          - "/api/v1/auth/register"
        
        # Session configuration
        session_cookie_name: "auth_session"
        session_duration: "24h"
        
        # Security settings
        enable_csrf: true
        enable_rate_limiting: true
        max_login_attempts: 5
        lockout_duration: "15m"
      
      # Permissions control what framework services the plugin can access
      permissions:
        database: true      # Access to DatabaseManager
        cache: true         # Access to CacheManager
        router: true        # Access to Router (register routes/middleware)
        config: true        # Access to ConfigManager
        filesystem: false   # Access to filesystem operations
        network: false      # Access to network operations
        exec: false         # Access to execute external commands
        
        # Custom permissions (optional)
        custom:
          user_management: true
          role_management: true
    
    # ========================================================================
    # Example 3: Logging Plugin
    # ========================================================================
    - name: logging-plugin
      enabled: true
      path: ./plugins/logging-plugin
      priority: 50
      
      config:
        # What to log
        log_requests: true
        log_responses: true
        log_headers: true
        log_body: false
        log_query_params: true
        
        # Log levels
        request_log_level: "info"
        error_log_level: "error"
        
        # Output configuration
        output_format: "json"  # json, text, or structured
        include_timestamp: true
        include_request_id: true
        
        # Performance
        async_logging: true
        buffer_size: 1000
        
        # Filtering
        excluded_paths:
          - "/health"
          - "/metrics"
        excluded_methods: []
        
        # Sensitive data masking
        mask_headers:
          - "Authorization"
          - "Cookie"
          - "X-API-Key"
        mask_query_params:
          - "password"
          - "token"
          - "api_key"
      
      permissions:
        database: false
        cache: false
        router: true
        config: true
        filesystem: true  # For writing log files
        network: false
        exec: false
    
    # ========================================================================
    # Example 4: Cache Plugin
    # ========================================================================
    - name: cache-plugin
      enabled: true
      path: ./plugins/cache-plugin
      priority: 150
      
      config:
        # Cache behavior
        enabled: true
        cache_duration: "10m"
        max_cache_size: "100MB"
        
        # What to cache
        cache_methods:
          - "GET"
          - "HEAD"
        
        # Cache key generation
        include_query_params: true
        include_headers: false
        custom_key_prefix: "api_cache"
        
        # Exclusions
        excluded_paths:
          - "/admin"
          - "/api/auth"
          - "/api/user/profile"
        excluded_content_types:
          - "text/event-stream"
          - "application/octet-stream"
        
        # Cache invalidation
        invalidate_on_mutation: true
        invalidation_patterns:
          - "/api/users/*"
          - "/api/posts/*"
        
        # Performance
        compression_enabled: true
        compression_threshold: "1KB"
      
      permissions:
        database: false
        cache: true
        router: true
        config: true
        filesystem: false
        network: false
        exec: false
    
    # ========================================================================
    # Example 5: Rate Limiting Plugin
    # ========================================================================
    - name: rate-limit-plugin
      enabled: true
      path: ./plugins/rate-limit-plugin
      priority: 180
      
      config:
        # Global rate limits
        global_limit: 1000
        global_window: "1m"
        
        # Per-IP rate limits
        per_ip_limit: 100
        per_ip_window: "1m"
        
        # Per-user rate limits (requires authentication)
        per_user_limit: 500
        per_user_window: "1m"
        
        # Custom rate limits for specific paths
        path_limits:
          - path: "/api/auth/login"
            limit: 5
            window: "5m"
          - path: "/api/search"
            limit: 50
            window: "1m"
          - path: "/api/upload"
            limit: 10
            window: "1h"
        
        # Response configuration
        return_rate_limit_headers: true
        rate_limit_exceeded_message: "Rate limit exceeded. Please try again later."
        rate_limit_exceeded_status: 429
        
        # Storage backend
        storage_backend: "redis"  # redis, memory, or database
        redis_url: "redis://localhost:6379"
      
      permissions:
        database: false
        cache: true
        router: true
        config: true
        filesystem: false
        network: true  # For Redis connection
        exec: false
    
    # ========================================================================
    # Example 6: Metrics Plugin
    # ========================================================================
    - name: metrics-plugin
      enabled: true
      path: ./plugins/metrics-plugin
      priority: 75
      
      config:
        # Metrics collection
        collect_request_metrics: true
        collect_response_metrics: true
        collect_error_metrics: true
        collect_performance_metrics: true
        
        # Metric types
        enable_counters: true
        enable_gauges: true
        enable_histograms: true
        enable_summaries: true
        
        # Performance
        sampling_rate: 1.0  # 1.0 = 100%, 0.1 = 10%
        aggregation_interval: "10s"
        
        # Export configuration
        export_format: "prometheus"  # prometheus, statsd, or json
        export_endpoint: "/metrics"
        export_interval: "15s"
        
        # Custom metrics
        custom_labels:
          environment: "production"
          service: "api"
          version: "1.0.0"
      
      permissions:
        database: false
        cache: false
        router: true
        config: true
        filesystem: false
        network: true  # For exporting metrics
        exec: false
    
    # ========================================================================
    # Example 7: Plugin with Dependencies
    # ========================================================================
    - name: advanced-auth-plugin
      enabled: false  # Disabled by default
      path: ./plugins/advanced-auth-plugin
      priority: 210
      
      config:
        oauth_providers:
          - name: "google"
            client_id: "your-client-id"
            client_secret: "your-client-secret"
            redirect_url: "https://yourdomain.com/auth/google/callback"
          - name: "github"
            client_id: "your-client-id"
            client_secret: "your-client-secret"
            redirect_url: "https://yourdomain.com/auth/github/callback"
        
        # This plugin depends on the auth-plugin
        # Dependencies are automatically resolved by the plugin manager
      
      permissions:
        database: true
        cache: true
        router: true
        config: true
        filesystem: false
        network: true  # For OAuth provider communication
        exec: false
    
    # ========================================================================
    # Example 8: Disabled Plugin
    # ========================================================================
    # This plugin is configured but not loaded due to enabled: false
    - name: experimental-plugin
      enabled: false
      path: ./plugins/experimental-plugin
      priority: 100
      
      config:
        experimental_feature: true
      
      permissions:
        database: false
        cache: false
        router: false
        config: false
        filesystem: false
        network: false
        exec: false

# ============================================================================
# Configuration Notes:
# ============================================================================
#
# 1. Load Order (Requirement 3.5):
#    Plugins are loaded in the order they appear in this file. This is
#    important for plugins with dependencies or when hook execution order
#    matters.
#
# 2. Enabled Flag (Requirement 3.3):
#    Only plugins with enabled: true are loaded. This allows you to keep
#    plugin configurations in the file without loading them.
#
# 3. Initialization Parameters (Requirement 3.4):
#    All values in the 'config' section are passed to the plugin's
#    Initialize() method as a map[string]interface{}.
#
# 4. Permissions:
#    Permissions control what framework services a plugin can access.
#    Always follow the principle of least privilege - only grant the
#    permissions a plugin actually needs.
#
# 5. Priority:
#    Higher priority plugins have their hooks executed first. Use this to
#    control the order of middleware and hook execution.
#
# 6. Paths:
#    Plugin paths can be:
#    - Absolute: /usr/local/plugins/my-plugin
#    - Relative to plugins.directory: ./my-plugin
#    - Relative to application: ../plugins/my-plugin
#
# ============================================================================
